<!doctype html><html lang=en-us><head><title>Host Website in AWS S3 // Alex Norell</title>
<link rel=apple-touch-icon sizes=57x57 href=/images/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/images/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#E6EDF3"><meta name=msapplication-TileImage content="/images/favicon/ms-icon-144x144.png"><meta name=theme-color content="#161B22"><meta charset=utf-8><meta name=generator content="Hugo 0.127.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Alex Norell"><meta name=description content><link rel=stylesheet href=/css/main.min.9f696a5bcb1bdf34cd045622efd3fcb9630ea4abfee07cf1a177e62162f5f731.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Host Website in AWS S3"><meta name=twitter:description content='I want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.
Set up provider This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, 0.13.
The provider is defined below, and located in main.tf
provider "aws" { version = "~> 3.'><meta property="og:url" content="https://alexnorell.com/post/host-website-in-aws/"><meta property="og:site_name" content="Alex Norell"><meta property="og:title" content="Host Website in AWS S3"><meta property="og:description" content='I want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.
Set up provider This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, 0.13.
The provider is defined below, and located in main.tf
provider "aws" { version = "~> 3.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-08-18T23:06:28-07:00"><meta property="article:modified_time" content="2020-08-18T23:06:28-07:00"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="AWS"><meta property="article:tag" content="S3"></head><body><header class=app-header><header class=app-header><div class=sidebar-single><div class=sidebar-content><span class=app-header-title>Alex Norell</span><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/about/>About</a>
-
<a class=app-header-menu-item href=/categories/>Categories</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a></nav><div class=sidebar-toc><nav id=TableOfContents><ul><li><a href=#set-up-provider>Set up provider</a></li><li><a href=#set-up-backend>Set up backend</a></li><li><a href=#add-s3-bucket>Add s3 bucket</a></li><li><a href=#configure-s3-bucket-to-be-public>Configure S3 Bucket to be public</a></li></ul></nav></div></div></div></header></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Host Website in AWS S3</h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> 
Aug 18, 2020</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> 
2 min read</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-folder"><title>folder</title><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg> 
<a class=tag href=https://alexnorell.com/categories/aws/>Aws</a></div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> 
<a class=tag href=https://alexnorell.com/tags/terraform/>Terraform</a>
<a class=tag href=https://alexnorell.com/tags/aws/>AWS</a>
<a class=tag href=https://alexnorell.com/tags/s3/>S3</a></div></div></header><div class=post-content><p>I want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.</p><h2 id=set-up-provider>Set up provider</h2><p>This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, <code>0.13</code>.</p><p>The provider is defined below, and located in <code>main.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>provider</span> <span style=color:#f1fa8c>&#34;aws&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>version</span> = <span style=color:#f1fa8c>&#34;~&gt; 3.0&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>region</span>  = <span style=color:#f1fa8c>&#34;us-west-1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=set-up-backend>Set up backend</h2><p>This project will use S3 as the backend for storing the terraform state files. I created an S3 bucket using the AWS cli.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>aws s3 mb s3://alexnorell-tfstates --region us-west-1
</span></span></code></pre></div><p>I then added the following to <code>backend.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span>terraform {
</span></span><span style=display:flex><span>  backend <span style=color:#f1fa8c>&#34;s3&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>bucket</span> = <span style=color:#f1fa8c>&#34;alexnorell-tfstates&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>key</span>    = <span style=color:#f1fa8c>&#34;website&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>region</span> = <span style=color:#f1fa8c>&#34;us-west-1&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=add-s3-bucket>Add s3 bucket</h2><p>I need a bucket to put the static website in. I added the s3 bucket configuration to <code>website.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_s3_bucket&#34;</span> <span style=color:#f1fa8c>&#34;website&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>bucket</span> = <span style=color:#f1fa8c>&#34;website.norell.dev&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>acl</span>    = <span style=color:#f1fa8c>&#34;public-read&#34;</span>
</span></span><span style=display:flex><span>  versioning {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>enabled</span> = <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  website {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>index_document</span> = <span style=color:#8be9fd;font-style:italic>&#34;index</span>.html<span style=color:#f1fa8c>&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    error_document = &#34;</span><span style=color:#bd93f9>404</span>.html<span style=color:#f1fa8c>&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>}
</span></span></span></code></pre></div><h2 id=configure-s3-bucket-to-be-public>Configure S3 Bucket to be public</h2><p>While the bucket has been given the <code>public-read</code> ACL, from the <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl>canned ACL list</a>, the IAM policy permissions haven&rsquo;t been set up. To do this, I&rsquo;ll create an IAM policy document.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>data</span> <span style=color:#f1fa8c>&#34;aws_iam_policy_document&#34;</span> <span style=color:#f1fa8c>&#34;website_read_access&#34;</span> {
</span></span><span style=display:flex><span>  statement {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>sid</span>       = <span style=color:#f1fa8c>&#34;PublicReadGetObject&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>effect</span>    = <span style=color:#f1fa8c>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>actions</span>   = [<span style=color:#f1fa8c>&#34;s3:GetObject&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>resources</span> = [<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span>aws_s3_bucket.website.arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/*&#34;</span>]
</span></span><span style=display:flex><span>    principals {
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>type</span>        = <span style=color:#f1fa8c>&#34;*&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>identifiers</span> = [<span style=color:#f1fa8c>&#34;*&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is the same as the standard JSON policy, but it fits into the terraform flow a lot better.</p><p>This policy then needs to be applied to the bucket.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_s3_bucket_policy&#34;</span> <span style=color:#f1fa8c>&#34;website_policy&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>bucket</span> = aws_s3_bucket.website.id
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>policy</span> = <span style=color:#8be9fd;font-style:italic>data</span>.aws_iam_policy_document.website_read_access.json
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now anything in the bucket will be public.</p></div></article><footer class=site-footer><div class=container><p>&copy; 2024 Alex Norell. All rights reserved.</p><div class=app-header-social><a href=https://github.com/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://linkedin.com/in/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>linkedin</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=https://youtube.com/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-youtube"><title>youtube</title><path d="M22.54 6.42a2.78 2.78.0 00-1.94-2C18.88 4 12 4 12 4s-6.88.0-8.6.46a2.78 2.78.0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78.0 003.4 19c1.72.46 8.6.46 8.6.46s6.88.0 8.6-.46a2.78 2.78.0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/></svg>
</a><a href=/post/index.xml target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss"><title>rss</title><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></footer></main><script src=/js/main.d8baa5fa5186a9dd80887489823b6ed242427f785b5976221665eef1e0f307c0.min.js></script></body></html>