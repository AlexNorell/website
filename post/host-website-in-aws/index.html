<!doctype html><html lang=en-us><head><title>Host Website in AWS S3 // Alex Norell</title><link rel="shortcut icon" href=images/favicon/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Alex Norell"><meta name=description content><link rel=stylesheet href=https://alexnorell.com/css/main.min.78ce516b8b5ad471a7a452fac3bf23012a8bd0ce212fc42d83c72e306bc719b0.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Host Website in AWS S3"><meta name=twitter:description content="I&rsquo;m want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.
Set up provider This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, 0.13.
The provider is defined below, and located in main.tf
provider &#34;aws&#34; { version = &#34;~> 3."><meta property="og:title" content="Host Website in AWS S3"><meta property="og:description" content="I&rsquo;m want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.
Set up provider This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, 0.13.
The provider is defined below, and located in main.tf
provider &#34;aws&#34; { version = &#34;~> 3."><meta property="og:type" content="article"><meta property="og:url" content="https://alexnorell.com/post/host-website-in-aws/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-08-18T23:06:28-07:00"><meta property="article:modified_time" content="2020-08-18T23:06:28-07:00"></head><body><header class=app-header><a href=https://alexnorell.com/><img class=app-header-avatar src=/images/avatar.jpg alt="Alex Norell"></a><h1>Alex Norell</h1><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/categories/>Categories</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a></nav><p>Software Engineer with a passion for IoT</p><div class=app-header-social><a target=_blank href=https://github.com/alexnorell rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://linkedin.com/in/alexnorell rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>linkedin</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a target=_blank href=https://twitter.com/alexnorell rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://youtube.com/alexnorell rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-youtube"><title>youtube</title><path d="M22.54 6.42a2.78 2.78.0 00-1.94-2C18.88 4 12 4 12 4s-6.88.0-8.6.46a2.78 2.78.0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78.0 003.4 19c1.72.46 8.6.46 8.6.46s6.88.0 8.6-.46a2.78 2.78.0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Host Website in AWS S3</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> 
Aug 18, 2020</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> 
2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-folder"><title>folder</title><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg> 
<a class=tag href=https://alexnorell.com/categories/aws/>aws</a></div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> 
<a class=tag href=https://alexnorell.com/tags/terraform/>terraform</a>
<a class=tag href=https://alexnorell.com/tags/aws/>AWS</a>
<a class=tag href=https://alexnorell.com/tags/s3/>s3</a></div></div></header><div class=post-content><p>I&rsquo;m want to deploy a copy of this website to AWS S3, and set up all of the necessary infrastructure using terraform. This post will go over the steps that were taken to achieve this.</p><h1 id=set-up-provider>Set up provider</h1><p>This will be using AWS, so the terraform provider must be set. This will use the latest terraform version, <code>0.13</code>.</p><p>The provider is defined below, and located in <code>main.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>provider</span> <span style=color:#f1fa8c>&#34;aws&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>version</span> = <span style=color:#f1fa8c>&#34;~&gt; 3.0&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>region</span>  = <span style=color:#f1fa8c>&#34;us-west-1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=set-up-backend>Set up backend</h1><p>This project will use S3 as the backend for storing the terraform state files. I created an S3 bucket using the AWS cli.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>aws s3 mb s3://alexnorell-tfstates --region us-west-1
</span></span></code></pre></div><p>I then added the following to <code>backend.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span>terraform {
</span></span><span style=display:flex><span>  backend <span style=color:#f1fa8c>&#34;s3&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>bucket</span> = <span style=color:#f1fa8c>&#34;alexnorell-tfstates&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>key</span>    = <span style=color:#f1fa8c>&#34;website&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>region</span> = <span style=color:#f1fa8c>&#34;us-west-1&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=add-s3-bucket>Add s3 bucket</h1><p>I need a bucket to put the static website in. I added the s3 bucket configuration to <code>website.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_s3_bucket&#34;</span> <span style=color:#f1fa8c>&#34;website&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>bucket</span> = <span style=color:#f1fa8c>&#34;website.norell.dev&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>acl</span>    = <span style=color:#f1fa8c>&#34;public-read&#34;</span>
</span></span><span style=display:flex><span>  versioning {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>enabled</span> = <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  website {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>index_document</span> = <span style=color:#8be9fd;font-style:italic>&#34;index</span>.html<span style=color:#f1fa8c>&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    error_document = &#34;</span><span style=color:#bd93f9>404</span>.html<span style=color:#f1fa8c>&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>}
</span></span></span></code></pre></div><h1 id=configure-s3-bucket-to-be-public>Configure S3 Bucket to be public</h1><p>While the bucket has been given the <code>public-read</code> ACL, from the <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl>canned ACL list</a>, the IAM policy permissions haven&rsquo;t been set up. To do this, I&rsquo;ll create an IAM policy document.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>data</span> <span style=color:#f1fa8c>&#34;aws_iam_policy_document&#34;</span> <span style=color:#f1fa8c>&#34;website_read_access&#34;</span> {
</span></span><span style=display:flex><span>  statement {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>sid</span>       = <span style=color:#f1fa8c>&#34;PublicReadGetObject&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>effect</span>    = <span style=color:#f1fa8c>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>actions</span>   = [<span style=color:#f1fa8c>&#34;s3:GetObject&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>resources</span> = [<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span>aws_s3_bucket.website.arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/*&#34;</span>]
</span></span><span style=display:flex><span>    principals {
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>type</span>        = <span style=color:#f1fa8c>&#34;*&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>identifiers</span> = [<span style=color:#f1fa8c>&#34;*&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is the same as the standard JSON policy, but it fits into the terraform flow a lot better.</p><p>This policy then needs to be applied to the bucket.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_s3_bucket_policy&#34;</span> <span style=color:#f1fa8c>&#34;website_policy&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>bucket</span> = aws_s3_bucket.website.id
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>policy</span> = <span style=color:#8be9fd;font-style:italic>data</span>.aws_iam_policy_document.website_read_access.json
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now anything in the bucket will be public.</p></div><div class=post-footer><script src=https://utteranc.es/client.js repo=alexnorell/website issue-term=pathname theme=dark-blue crossorigin=anonymous async></script></div></article></main></body></html>