<!doctype html><html lang=en-us><head><title>Add External Domain in AWS and create record for S3 // Alex Norell</title>
<link rel=apple-touch-icon sizes=57x57 href=/images/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/images/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#E6EDF3"><meta name=msapplication-TileImage content="/images/favicon/ms-icon-144x144.png"><meta name=theme-color content="#2F81F7"><meta charset=utf-8><meta name=generator content="Hugo 0.127.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Alex Norell"><meta name=description content><link rel=stylesheet href=/css/main.min.d197d68811c414822ebcb7b865495e49efed1a91bd68821be7163518ed04dfba.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Add External Domain in AWS and create record for S3"><meta name=twitter:description content="I have a domain name, norell.dev that is registered outside of AWS. I would like to use it for my development within AWS, but Amazon doesn’t support the .dev domain name. Google is the gTLD owner, and Amazon and Google don’t play well together. Even though Amazon won’t let me transfer my domain to be registered in Route53, I can still configure it to be used using Hosted Zones.
I will follow this guide to get it set up."><meta property="og:url" content="https://alexnorell.com/post/add-external-domain-aws/"><meta property="og:site_name" content="Alex Norell"><meta property="og:title" content="Add External Domain in AWS and create record for S3"><meta property="og:description" content="I have a domain name, norell.dev that is registered outside of AWS. I would like to use it for my development within AWS, but Amazon doesn’t support the .dev domain name. Google is the gTLD owner, and Amazon and Google don’t play well together. Even though Amazon won’t let me transfer my domain to be registered in Route53, I can still configure it to be used using Hosted Zones.
I will follow this guide to get it set up."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-08-19T21:21:09-07:00"><meta property="article:modified_time" content="2020-08-19T21:21:09-07:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Route53"><meta property="article:tag" content="Domain Name"><meta property="article:tag" content="S3"></head><body><header class=app-header><header class=app-header><div class=sidebar-single><div class=sidebar-content><span class=app-header-title>Alex Norell</span><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/about/>About</a>
-
<a class=app-header-menu-item href=/categories/>Categories</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a></nav><div class=sidebar-toc><nav id=TableOfContents><ul><li><a href=#steps>Steps</a></li><li><a href=#configure-website-to-use-domain>Configure website to use domain</a><ul><li><a href=#get-hosted-zone-information>Get Hosted Zone information</a></li><li><a href=#reconfigure-s3-bucket>Reconfigure S3 Bucket</a></li><li><a href=#create-the-alias>Create the alias</a></li></ul></li></ul></nav></div></div></div></header></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Add External Domain in AWS and create record for S3</h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> 
Aug 19, 2020</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> 
2 min read</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-folder"><title>folder</title><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg> 
<a class=tag href=https://alexnorell.com/categories/aws/>Aws</a></div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> 
<a class=tag href=https://alexnorell.com/tags/aws/>AWS</a>
<a class=tag href=https://alexnorell.com/tags/route53/>Route53</a>
<a class=tag href=https://alexnorell.com/tags/domain-name/>Domain Name</a>
<a class=tag href=https://alexnorell.com/tags/s3/>S3</a></div></div></header><div class=post-content><p>I have a domain name, <code>norell.dev</code> that is registered outside of AWS. I would like to use it for my development within AWS, but Amazon doesn&rsquo;t support the <code>.dev</code> domain name. Google is the gTLD owner, and Amazon and Google don&rsquo;t play well together. Even though Amazon won&rsquo;t let me transfer my domain to be registered in Route53, I can still configure it to be used using Hosted Zones.</p><p>I will follow <a href=https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/migrate-dns-domain-inactive.html>this guide</a> to get it set up.</p><h2 id=steps>Steps</h2><ol><li>Log into AWS Route53</li><li>Add Hosted Zone</li><li>Log into registrar (Namecheap, GoDaddy, Google, etc.)</li><li>Change domain specific name server to the ones provided by AWS Route53</li><li>Wait 24-48 hours if you had DNSSEC enabled</li></ol><h2 id=configure-website-to-use-domain>Configure website to use domain</h2><p>Now that the domain is in Route53, I can set the domain for use by the website hosted in S3. You can find more information on that from the <a href=../host-website-in-aws>previous post</a>.</p><h3 id=get-hosted-zone-information>Get Hosted Zone information</h3><p>I don&rsquo;t want to have terraform manage the top level hosted zone, so I will use a <code>data</code> type to retrieve the information from Route53. In <code>domain.tf</code> I added:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>variable</span> <span style=color:#f1fa8c>&#34;domain_name&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>description</span> = <span style=color:#f1fa8c>&#34;domain name to use from route53&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>default</span> = <span style=color:#f1fa8c>&#34;norell.dev&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>variable</span> <span style=color:#f1fa8c>&#34;subdomain&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>description</span> = <span style=color:#f1fa8c>&#34;subdomain to create record and bucket for&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>default</span> = <span style=color:#f1fa8c>&#34;www&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>data</span> <span style=color:#f1fa8c>&#34;aws_route53_zone&#34;</span> <span style=color:#f1fa8c>&#34;domain&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>name</span> = <span style=color:#8be9fd;font-style:italic>var</span>.domain_name
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I want to make this generic, so I created variables, one for the generic top level domain name, and one for the subdomain. In this case, it is <code>norell.dev</code> and <code>www</code>.</p><h3 id=reconfigure-s3-bucket>Reconfigure S3 Bucket</h3><p>I created the S3 bucket for this website with the incorrect name. It needs to be <strong>exactly</strong> the same name as the domain name for Route53 to route to it. Since we have a variable for the subdomain now, and we have a data object for the domain hosted zone, we can use those to define the bucket name.</p><p>In <code>website.tf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_s3_bucket&#34;</span> <span style=color:#f1fa8c>&#34;website&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>bucket</span> = <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>var</span>.subdomain<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>data</span>.aws_route53_zone.domain.name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=create-the-alias>Create the alias</h3><p>To add the alias for the bucket, I added the alias definition for the subdomain</p><p>Adding to <code>domain.tf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#ff79c6>resource</span> <span style=color:#f1fa8c>&#34;aws_route53_record&#34;</span> <span style=color:#f1fa8c>&#34;www&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>zone_id</span> = <span style=color:#8be9fd;font-style:italic>data</span>.aws_route53_zone.domain.zone_id
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>name</span>    = <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>var</span>.subdomain<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>data</span>.aws_route53_zone.domain.name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>type</span>    = <span style=color:#f1fa8c>&#34;A&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  alias {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>name</span>                   = aws_s3_bucket.website.website_domain
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>zone_id</span>                = aws_s3_bucket.website.hosted_zone_id
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>evaluate_target_health</span> = <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This grabs the domain and hosted zone ID from the bucket, allowing for no hardcoded values for the alias.</p></div></article><footer class=site-footer><div class=container><p>&copy; 2024 Alex Norell. All rights reserved.</p><div class=app-header-social><a href=https://github.com/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://linkedin.com/in/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>linkedin</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=https://youtube.com/alexnorell target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-youtube"><title>youtube</title><path d="M22.54 6.42a2.78 2.78.0 00-1.94-2C18.88 4 12 4 12 4s-6.88.0-8.6.46a2.78 2.78.0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78.0 003.4 19c1.72.46 8.6.46 8.6.46s6.88.0 8.6-.46a2.78 2.78.0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/></svg>
</a><a href=/post/index.xml target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss"><title>rss</title><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></footer></main><script src=/js/main.d8baa5fa5186a9dd80887489823b6ed242427f785b5976221665eef1e0f307c0.min.js></script></body></html>