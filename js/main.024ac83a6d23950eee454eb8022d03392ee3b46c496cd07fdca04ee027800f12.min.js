document.addEventListener("DOMContentLoaded",()=>{initLightbox(),wrapHeadersWithLinks(),setupSidebarTOC()});function initLightbox(){const t=document.querySelectorAll(".lightbox-image"),e=createLightbox();let n=0;t.forEach((s,o)=>{s.addEventListener("click",i=>{i.preventDefault(),n=o;const a=s.getAttribute("href"),r=s.getAttribute("title");updateLightbox(e,a,r,n,t.length)})}),e.querySelector(".close").addEventListener("click",()=>{e.classList.remove("active")}),e.querySelector("img").addEventListener("click",()=>{e.classList.remove("active")}),document.addEventListener("keydown",t=>{e.classList.contains("active")&&(t.key==="ArrowRight"||t.key==="l"?s(1):t.key==="ArrowLeft"||t.key==="h"?s(-1):t.key==="Escape"&&e.classList.remove("active"))});function s(s){n=(n+s+t.length)%t.length;const o=t[n],i=o.getAttribute("href"),a=o.getAttribute("title");updateLightbox(e,i,a,n,t.length)}}function createLightbox(){const e=document.createElement("div");e.classList.add("lightbox");const n=document.createElement("div");n.classList.add("title"),e.appendChild(n);const s=document.createElement("img");e.appendChild(s);const t=document.createElement("button");return t.innerText="Ã—",t.classList.add("close"),e.appendChild(t),document.body.appendChild(e),e}function updateLightbox(e,t,n){const i=e.querySelector("img"),a=e.querySelector(".title");i.setAttribute("src",t),a.innerText=n,e.classList.add("active")}function wrapHeadersWithLinks(){document.querySelectorAll("h2, h3, h4, h5, h6").forEach(e=>{if(e.id){const t=document.createElement("a");for(t.href=`#${e.id}`,t.classList.add("header-link");e.firstChild;)t.appendChild(e.firstChild);e.appendChild(t)}})}function toggleExpand(e){const t=e.closest(".expandable-box");t.classList.toggle("expanded"),e.classList.toggle("expanded")}function setupSidebarTOC(){const e=document.querySelector(".sidebar-content");if(e&&e.offsetParent!==null){const e=document.querySelectorAll(".sidebar-toc a"),t=Array.from(document.querySelectorAll("h2, h3, h4, h5, h6"));window.addEventListener("scroll",()=>markScrolledPastLinks(t,e)),markScrolledPastLinks(t,e),e.forEach(t=>{t.addEventListener("click",function(){activateLink(e,this)})})}}function activateLink(e,t){e.forEach(e=>e.classList.remove("active")),t&&t.classList.add("active")}function markScrolledPastLinks(e,t){let n=window.scrollY+10;e.forEach((e,s)=>{const o=t[s];o&&(e.offsetTop-40<=n&&activateLink(t,o),e.offsetTop+e.offsetHeight<=n?o.classList.add("scrolled-past"):o.classList.remove("scrolled-past"))})}